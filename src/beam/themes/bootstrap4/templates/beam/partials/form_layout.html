{% load beam_tags %}
{% load crispy_forms_tags %}

{% if fields and not layout %}
    {% fields_to_layout form.fields as layout %}
{% elif not fields and not layout %}
    {% fields_to_layout form.fields as layout %}
{% endif %}

{% for row in layout %}
    <div class="row">
    {% for col in row %}
        {% if row|length_is:1 %}
            <div class="col-md-12">
        {% elif row|length_is:2 %}
            <div class="col-md-6">
        {% elif row|length_is:3 %}
            <div class="col-md-4">
        {% elif row|length_is:4 %}
            <div class="col-md-3">
        {% endif %}
    <dl class="row">
        {% for field in col %}
            {% if field.is_html %}
                <div class="col-sm-12">
                    {{ field.content|safe }}
                </div>
            {% else %}
                {% get_form_field form field as form_field %}
                {% if form_field is None %}
                    <dt class="col-sm-4 col-md-4 col-lg-3">
                        {{ form.instance|field_verbose_name:field|capfirst }}
                    </dt>
                    <dd class="col-sm-8 col-md-8 col-lg-9">
                        {% include "beam/partials/detail_field.html" with object=form.instance field=field %}
                    </dd>
                {% elif not form_field.is_hidden %}
                    <dt class="col-sm-4 col-md-4 col-lg-3">
                        <label for="{{ form_field.auto_id }}">{{ form_field.label }}</label>
                    </dt>
                    <dd class="col-sm-8 col-md-8 col-lg-9">
                        {% include "bootstrap4/field.html" with field=form_field form_show_errors=True %}
                    </dd>
                {% endif %}
            {% endif %}
        {% endfor %}
    </dl>
    </div>
    {% endfor %}
    {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
</div>
{% endfor %}

